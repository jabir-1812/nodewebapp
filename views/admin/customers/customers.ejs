<style>
   /* Main Content Styles */
 .main-content {
     margin-left: 250px;
     margin-top: 70px;
     padding: 2rem;
     min-height: calc(100vh - 120px);
 }

 /* Search Form Styles */
 .search-form {
     margin-bottom: 2rem;
     display: flex;
     gap: 10px;
     max-width: 500px;
 }

 .search-form input {
     flex: 1;
     padding: 10px 15px;
     border: 1px solid #e2e8f0;
     border-radius: 6px;
     font-size: 1rem;
     transition: all 0.2s ease;
 }

 .search-form input:focus {
     border-color: #3182ce;
     box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.2);
     outline: none;
 }

 .search-form button {
     padding: 10px 20px;
     /* background-color: #3182ce; */
     color: white;
     border: none;
     border-radius: 6px;
     font-weight: 500;
     cursor: pointer;
     transition: all 0.2s ease;
 }
/* 
 .search-form button:hover {
     background-color: #2c5282;
 } */

 /* Table Styles */
 table {
     width: 100%;
     border-collapse: collapse;
     margin-bottom: 2rem;
     background: white;
     box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
     border-radius: 8px;
     overflow: hidden;
 }

 th,
 td {
     padding: 12px 15px;
     text-align: left;
     border-bottom: 1px solid #e2e8f0;
 }

 th {
     background-color: #000000;
     color: #ffffff;
     font-weight: 600;
     text-transform: uppercase;
     font-size: 0.8rem;
     letter-spacing: 0.5px;
 }

 tr:hover {
     background-color: #e7e7e7;
 }

 /* Button Styles */
 .btn {
     padding: 6px 12px;
     border-radius: 4px;
     font-size: 0.85rem;
     font-weight: 500;
     cursor: pointer;
     transition: all 0.2s ease;
     text-decoration: none;
     display: inline-block;
 }

 .btn-danger {
     background-color: #e53e3e;
     color: white;
     border: none;
 }

 .btn-danger:hover {
     background-color: #c53030;
 }

 .btn-success {
     background-color: #38a169;
     color: white;
     border: none;
 }

 .btn-success:hover {
     background-color: #2f855a;
 }

 /* Pagination Styles */
 /* .pagination {
     display: flex;
     justify-content: center;
     list-style: none;
     padding: 0;
     margin-top: 2rem;
 }

 .page-item {
     margin: 0 5px;
 }

 .page-link {
     padding: 8px 12px;
     border: 1px solid #e2e8f0;
     border-radius: 4px;
     color: #4a5568;
     text-decoration: none;
     transition: all 0.2s ease;
 }

 .page-item.active .page-link {
     background-color: #3182ce;
     border-color: #3182ce;
     color: white;
 }

 .page-link:hover {
     background-color: #f7fafc;
 } */


 .pagination {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
    margin-top: 1.5rem;
}

.pagination a {
    padding: 0.5rem 1rem;
    text-decoration: none;
    color: #000000;
    border: 1px solid #ddd;
    border-radius: 4px;
    transition: all 0.3s;
}

.pagination a:hover {
    background-color: #bcbcbc;
}

.pagination a.active {
    background-color: #000000;
    color: white;
    border-color: #000000;
}
 /* Responsive Design */
 @media (max-width: 768px) {
     .main-content {
         margin-left: 70px;
     }

     table {
         display: block;
         overflow-x: auto;
     }
 }

 @media (max-width: 480px) {
     .main-content {
         padding: 1rem;
     }

     .search-form {
         flex-direction: column;
     }

     th,
     td {
         padding: 8px 10px;
     }
 }
</style>



<%-include ('../../../views/partials/admin/header')%>


<div class="main-content">
  <h1>Customer Management</h1>
  <!-- search users -->
  <form action="/admin/users" method="get" class="search-form">
    <input type="text" name="search"
           value="<%if(search.length>0){%><%=search%><%}%>"
           placeholder="Search usename or email">
    <button type="submit" class="btn btn-dark">Search</button> 
  </form>
  <% if(search){ %>
    <a href="/admin/users" class="btn btn-dark-primary">
      Clear
    </a><br>
    <% }else{ %>
      <button class="btn btn-outline-dark" disabled>
         Clear
      </button><br>
    <% } %>

  <!-- users lists --> <br><br>
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Action</th>
        </tr>
      </thead>

      <tbody>
        <% for(let i=0;i< data.length;i++){ %>
          <tr>
            <td><%=data[i].name%></td>
            <td><%=data[i].email%></td>
            <td><%=data[i].phone || 'N/A'%></td>
            <td>
              <button class="<%= data[i].isBlocked ? 'btn btn-success' : 'btn btn-danger' %>"
                      id="user-<%= data[i]._id %>"
                      data-user-id="<%= data[i]._id %>"
                      data-is-blocked="<%= data[i].isBlocked %>"
                      onclick="blockOrUnblockUser(this)">
                <%= data[i].isBlocked ? "Unblock" : "Block" %>
              </button>
            </td>
          </tr>
        <%}%>
      </tbody>
    </table>
  </div>

<!-- pagination -->
  <% if (totalPages > 1) { %>
        <div class="pagination">
            <% if (currentPage > 1) { %>
                <a href="/admin/users?page=<%= currentPage - 1 %>&search=<%= search %>">Previous</a>
            <% } %>

            <% for(let i=1; i <=totalPages; i++) { %>
                <a href="/admin/users?page=<%= i %>&search=<%= search %>" class="<%= currentPage === i ? 'active' : '' %>">
                    <%= i %>
                </a>
            <% } %>

            <% if (currentPage < totalPages) { %>
                <a href="/admin/users?page=<%= currentPage + 1 %>&search=<%= search %>">Next</a>
            <% } %>
        </div>
    <% } %>
</div>

 <%-include ('../../../views/partials/admin/footer')%>
 <script>

  async function blockOrUnblockUser(button) {
    try {
     const userId=button.dataset.userId;
     const isBlocked=button.dataset.isBlocked==="true";
     const action=isBlocked ? 'unblock' : 'block';

     if(action==="block"){
      const result = await Swal.fire({
        title: `Are you sure you want to block this user?`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: `Yes, block them!`,
        cancelButtonText: 'Cancel',
       });

       if(result.isConfirmed){
        const response=await fetch('/admin/block-customer',{
          method:"post",
          headers:{
            'Content-Type':'application/json'
          },
          body:JSON.stringify({userId})
        });

        const data=await response.json();
        await Swal.fire("Done!",data.message);
        if(data.success){
          console.log("data success unblock")
          const blockUnblockButton=document.getElementById(`user-${userId}`);
          blockUnblockButton.textContent="Unblock";
          blockUnblockButton.dataset.isBlocked=true;
          blockUnblockButton.className="";
          blockUnblockButton.classList.add('btn-success')
        }
        
       } 
     }
     if(action==="unblock"){
      const result = await Swal.fire({
        title: `Are you sure you want to unblock this user?`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: `Yes, unblock them!`,
        cancelButtonText: 'Cancel',
       });

       if(result.isConfirmed){
        const response=await fetch('/admin/unblock-customer',{
          method:"post",
          headers:{
            'Content-Type':'application/json'
          },
          body:JSON.stringify({userId})
        });
        const data=await response.json();
        await Swal.fire("Done!",data.message);

        if(data.success){
          console.log("data success block")
          const blockUnblockButton=document.getElementById(`user-${userId}`);
          blockUnblockButton.textContent="Block";
          blockUnblockButton.dataset.isBlocked=false;
          blockUnblockButton.className="";
          blockUnblockButton.classList.add('btn-danger');
        }

       }
     }

    } catch (error) {
      console.log("error fetching:",error)
    }
  }
 </script>