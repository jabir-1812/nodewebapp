<style>
    /* Wishlist Container */
    .wishlist-container {
        max-width: 1200px;
        margin: 2rem auto;
        padding: 0 1.5rem;
    }

    /* Header Styles */
    .wishlist-header {
        text-align: center;
        margin-bottom: 2.5rem;
    }

    .wishlist-header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        color: #2d3748;
        margin-bottom: 0.5rem;
    }

    .wishlist-header p {
        color: #718096;
        font-size: 1.1rem;
    }

    /* Wishlist Grid */
    .wishlist-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
    }

    /* Wishlist Card */
    .wishlist-card {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.04);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        position: relative;
    }

    .wishlist-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    }

    /* Image Container */
    .wishlist-image-container {
        position: relative;
        height: 220px;
        overflow: hidden;
    }

    .wishlist-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .wishlist-card:hover .wishlist-image {
        transform: scale(1.05);
    }

    /* Discount Badge */
    .discount-badge {
        position: absolute;
        top: 12px;
        left: 12px;
    }

    .badge {
        background: #e53e3e;
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    /* Remove Button */
    .remove-btn {
        position: absolute;
        top: 12px;
        right: 12px;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: white;
        border: none;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background 0.2s ease;
    }

    .remove-btn:hover {
        background: #feb2b2;
        color: #c53030;
    }

    /* Product Details */
    .wishlist-details {
        padding: 1.25rem;
    }

    .product-name {
        display: block;
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 0.75rem;
        text-decoration: none;
        transition: color 0.2s ease;
    }

    .product-name:hover {
        color: #4a5568;
    }

    /* Price Container */
    .price-container {
        margin-bottom: 1rem;
    }

    .sale-price {
        font-size: 1.25rem;
        font-weight: 700;
        color: #2d3748;
    }

    .regular-price {
        font-size: 0.9rem;
        color: #a0aec0;
        text-decoration: line-through;
        margin-left: 0.5rem;
    }

    /* Add to Cart Button */
    .add-to-cart-btn {
        width: 100%;
        padding: 0.75rem 1rem;
        background: #3182ce;
        color: white;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        transition: background 0.2s ease;
    }

    .add-to-cart-btn:hover {
        background: #2c5282;
    }

    .cart-icon {
        margin-right: 0.25rem;
    }

    /* Empty Wishlist */
    .empty-wishlist {
        text-align: center;
        padding: 4rem 2rem;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.04);
    }

    .empty-wishlist svg {
        color: #cbd5e0;
        margin-bottom: 1.5rem;
    }

    .empty-wishlist h2 {
        font-size: 1.5rem;
        color: #4a5568;
        margin-bottom: 0.75rem;
    }

    .empty-wishlist p {
        color: #718096;
        margin-bottom: 2rem;
    }

    .browse-products-btn {
        display: inline-block;
        padding: 0.75rem 1.5rem;
        background: #3182ce;
        color: white;
        text-decoration: none;
        border-radius: 6px;
        font-weight: 600;
        transition: background 0.2s ease;
    }

    .browse-products-btn:hover {
        background: #2c5282;
    }

    /* Pagination */
    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 0.5rem;
        margin-top: 3rem;
    }

    .pagination-btn, .pagination-number {
        padding: 0.5rem 1rem;
        border-radius: 6px;
        text-decoration: none;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 0.25rem;
        transition: all 0.2s ease;
    }

    .pagination-btn {
        background: #edf2f7;
        color: #4a5568;
    }

    .pagination-number {
        background: white;
        color: #4a5568;
        border: 1px solid #e2e8f0;
    }

    .pagination-btn:hover, .pagination-number:hover {
        background: #e2e8f0;
    }

    .pagination-number.active {
        background: #3182ce;
        color: white;
        border-color: #3182ce;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .wishlist-grid {
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 1.5rem;
        }
        
        .wishlist-header h1 {
            font-size: 2rem;
        }
        
        .pagination {
            flex-wrap: wrap;
        }
    }

    @media (max-width: 480px) {
        .wishlist-container {
            padding: 0 1rem;
        }
        
        .wishlist-grid {
            grid-template-columns: 1fr;
        }
        
        .wishlist-header h1 {
            font-size: 1.75rem;
        }
    }
</style>


<%- include("../../../views/partials/user/header") %>

<div class="wishlist-container">
    <div class="wishlist-header">
        <h1>Your Wishlist</h1>
        <p><%= wishlistData && wishlistData.length > 0 ? `${wishlistData.length} item(s)` : 'Save your favorite items here' %></p>
    </div>

    <% if(wishlistData && wishlistData.length>0){ %>
        <div class="wishlist-grid">
            <% wishlistData.forEach((item)=>{ %>
                <div class="wishlist-card" id="wishlist-item-<%= item.productId._id %>">
                    <div class="wishlist-image-container">
                        <a href="/product-details?id=<%= item.productId._id %>">
                            <img src="/uploads/product-images/<%= item.productId.productImage[0] %>" alt="<%= item.productId.productName %>" class="wishlist-image">
                            <div class="discount-badge">
                                <% const discount = Math.round(((item.productId.regularPrice - item.productId.salePrice)/item.productId.regularPrice)*100) %>
                                <% if(discount > 0) { %>
                                    <span class="badge">-<%= discount %>%</span>
                                <% } %>
                            </div>
                        </a>
                        <button onclick="removeFromWishlist('<%= item.productId._id %>')" class="remove-btn" title="Remove from wishlist">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M18 6L6 18M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="wishlist-details">
                        <a href="/product-details?id=<%= item.productId._id %>" class="product-name">
                            <%= item.productId.productName%>
                        </a>
                        
                        <div class="price-container">
                            <span class="sale-price">Rs. <%= item.productId.salePrice%></span>
                            <% if(item.productId.regularPrice > item.productId.salePrice) { %>
                                <span class="regular-price">Rs. <%= item.productId.regularPrice %></span>
                            <% } %>
                        </div>
                        
                        <button onclick="addToCart('<%= item.productId._id %>')" class="add-to-cart-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="cart-icon">
                                <circle cx="9" cy="21" r="1"></circle>
                                <circle cx="20" cy="21" r="1"></circle>
                                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                            </svg>
                            Add to cart
                        </button>
                    </div>
                </div>
            <% })%>
        </div>

        <!-- Pagination controls -->
        <% if(totalPages > 1) { %>
            <div class="pagination">
                <% if (currentPage > 1) { %>
                    <a href="?page=<%= currentPage - 1 %>" class="pagination-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                        Prev
                    </a>
                <% } %>

                <% for (let i = 1; i <= totalPages; i++) { %>
                    <a href="?page=<%= i %>" class="pagination-number <%= currentPage === i ? 'active' : '' %>">
                        <%= i %>
                    </a>
                <% } %>

                <% if (currentPage < totalPages) { %>
                    <a href="?page=<%= currentPage + 1 %>" class="pagination-btn">
                        Next
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </a>
                <% } %>
            </div>
        <% } %>
    <% } else { %>
        <div class="empty-wishlist">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"></path>
            </svg>
            <h2>Your wishlist is empty</h2>
            <p>Save your favorite items here for easy access later</p>
            <a href="/shop" class="browse-products-btn">Browse Products</a>
        </div>
    <% } %>
</div>



<%- include("../../../views/partials/user/footer") %>

<script>
    async function addToCart(productId) {
        try {
            const response=await fetch('/add-to-cart',{
                method:'post',
                headers:{
                    'Content-Type':'application/json'
                },
                body:JSON.stringify({productId:productId})
            })
            const responseJson=await response.json();

            if(responseJson.status===true){
                await Swal.fire({
                    title:'Success',
                    text:'Item Added to Cart',
                    icon:'success',
                    timer:1000,
                    showConfirmButton:false
                })
                document.getElementById(`wishlist-item-${productId}`).remove()
                // update cart icon
                document.getElementById('cartCount').textContent = responseJson.cartLength;
            }else{
                throw new Error(responseJson.message || 'Failed to add to cart');
            }
        } catch (error) {
            console.error("Error:",error),
            Swal.fire({
                title:"Oh no !",
                text:error.message || 'Something went wrong',
                icon:'warning'
            })
        }
    }


    async function removeFromWishlist(prodcutId) {
        try {
            const response=await fetch(`/wishlist/remove/${prodcutId}`,{
                method:'DELETE'
            });

            const result=await response.json();
            if(result.success){
                document.getElementById(`wishlist-item-${prodcutId}`).remove();
                Swal.fire({
                    title:"Done",
                    text:"Removed from wishlist",
                    icon:"success",
                    timer:1000,
                    showCofirmButton:false
                })
            }else{
                Swal.fire({
                    title:"Error",
                    text:result.message,
                    icon:"error"
                })
            }
        } catch (error) {
            console.log("Something went wrong===>",error)
            Swal.fire("Oh ! Something went wrong",error,"error")
        }
    }
</script>