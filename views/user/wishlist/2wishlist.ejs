<%- include("../../../views/partials/user/header") %>

<style>
    /* Container for wishlist items */
    .wishlist-container {
        max-width: 1200px;
        margin: 20px auto;
        padding: 0 15px;
    }

    .wishlist-title {
        text-align: center;
        font-size: 28px;
        margin-bottom: 30px;
        color: #333;
    }

    /* Grid layout for wishlist items */
    .wishlist-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    /* Individual wishlist item card */
    .wishlist-item {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        background-color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        transition: transform 0.2s;
    }

    .wishlist-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    /* Product image */
    .product-image {
        width: 100%;
        height: 250px;
        object-fit: cover;
        border-radius: 5px;
        margin-bottom: 10px;
    }

    /* Product name */
    .product-name {
        font-size: 18px;
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
    }

    /* Brand name */
    .product-brand {
        font-size: 14px;
        color: #666;
        margin-bottom: 10px;
    }

    /* Price section */
    .product-price {
        margin-bottom: 15px;
        font-size: 18px;
    }

    .sale-price {
        color: #e74c3c;
        font-weight: bold;
    }

    .regular-price {
        color: #999;
        font-size: 14px;
        margin-left: 8px;
    }

    /* Button container */
    .button-container {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    /* Buttons */
    .btn {
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: background-color 0.3s;
    }

    .btn-cart {
        background-color: #3498db;
        color: white;
    }

    .btn-cart:hover {
        background-color: #2980b9;
    }

    .btn-remove {
        background-color: #e74c3c;
        color: white;
    }

    .btn-remove:hover {
        background-color: #c0392b;
    }

    /* Pagination */
    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        margin: 40px 0;
        padding: 20px;
    }

    .pagination a {
        padding: 10px 20px;
        background-color: #3498db;
        color: white;
        text-decoration: none;
        border-radius: 5px;
        transition: background-color 0.3s;
    }

    .pagination a:hover {
        background-color: #2980b9;
    }

    .pagination span {
        font-size: 16px;
        color: #333;
    }

    /* Empty wishlist message */
    .empty-wishlist {
        text-align: center;
        padding: 50px;
        font-size: 18px;
        color: #666;
    }

    /* Responsive design */
    @media (max-width: 768px) {
        .wishlist-grid {
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        }

        .product-image {
            height: 200px;
        }

        .pagination {
            flex-direction: column;
            gap: 10px;
        }
    }
</style>

<div class="wishlist-container">
    <h1 class="wishlist-title">My Wishlist</h1>

    <% if(wishlist.length !== 0){ %>
        <div class="wishlist-grid">
            <% wishlist.forEach((item)=>{ %>
                <div class="wishlist-item">
                    <img class="product-image" src="<%= item.productId.productImage[0].url %>" alt="<%= item.productId.productName %>">
                    
                    <div class="product-name"><%= item.productId.productName %></div>
                    
                    <div class="product-brand"><%= item.productId.brand?.brandName %></div>
                    
                    <div class="product-price">
                        <span class="sale-price">₹ <%= item.productId.salePrice.toFixed(2) %> /-</span>
                        <strike class="regular-price">₹ <%= item.productId.regularPrice %> /-</strike>
                    </div>
                    
                    <div class="button-container">
                        <button class="btn btn-cart" onclick="addToCart('<%= item.productId._id %>')">Add to Cart</button>
                        <button class="btn btn-remove" onclick="removeFromWishlist('<%= item.productId._id %>')">Remove from Wishlist</button>
                    </div>
                </div>
            <% }) %>
        </div>
    <% } else { %>
        <div class="empty-wishlist">
            <p>Your wishlist is empty. Start adding items you love!</p>
        </div>
    <% } %>

    <% if(wishlist.length !== 0){ %>
        <div class="pagination">
            <% if (currentPage > 1) { %>
                <a href="/wishlist?page=<%= currentPage - 1 %>&limit=6">← Previous</a>
            <% } %>

            <span>Page <%= currentPage %> of <%= totalPages %></span>

            <% if (currentPage < totalPages) { %>
                <a href="/wishlist?page=<%= currentPage + 1 %>&limit=6">Next →</a>
            <% } %>
        </div>
    <% } %>
</div>

<%- include("../../../views/partials/user/footer") %>

<script>
    async function addToCart(productId) {
        try {
            const response=await fetch('/wishlist/add-to-cart',{
                method:'post',
                headers:{
                    'Content-Type':'application/json'
                },
                body:JSON.stringify({productId:productId})
            })
            const responseJson=await response.json();

            if(responseJson.status===true){
                await Swal.fire({
                    title:'Success',
                    text:'Item Added to Cart',
                    icon:'success',
                    timer:1000,
                    showConfirmButton:false
                }).then(()=>{
                    location.reload();
                })
            }else{
                throw new Error(responseJson.message || 'Failed to add to cart');
            }
        } catch (error) {
            console.error("Error:",error),
            Swal.fire({
                title:"Oh no !",
                text:error.message || 'Something went wrong',
                icon:'warning'
            })
        }
    }


    async function removeFromWishlist(prodcutId) {
        try {
            const response=await fetch(`/wishlist/remove/${prodcutId}`,{
                method:'DELETE'
            });

            const result=await response.json();
            if(result.success){
                Swal.fire({
                    title:"Done",
                    text:"Removed from wishlist",
                    icon:"success",
                    timer:5000,
                    showCofirmButton:false
                }).then(()=>{
                    location.reload();
                })
            }else{
                Swal.fire({
                    title:"Error",
                    text:result.message,
                    icon:"error"
                })
            }
        } catch (error) {
            console.log("Something went wrong===>",error)
            Swal.fire("Oh ! Something went wrong",error,"error")
        }
    }
</script>