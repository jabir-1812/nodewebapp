<link rel="stylesheet" href="/user/reset-password.css">



<div class="password-form-container">
  <h2>Change Password</h2>
  <form id="resetPasswordForm" method="post" action="/reset-password" onsubmit="return validateForm()">
    <div class="form-group">
      <input class="form-control" name="newPass1" id="newPass1" 
             placeholder="Enter new password" type="password" required>
      <div id="newPass1Error" class="text-danger"></div>
    </div>

    <div class="form-group">
      <input class="form-control" name="newPass2" id="newPass2" 
             placeholder="Re-enter new password" type="password" required>
      <div id="newPass2Error" class="text-danger"></div>
    </div>

    <button type="submit">Change Password</button>

    <% if (locals.message && message.length > 0) { %>
      <div id="alertMessage" class="alert alert-danger">
        <%= message %>
      </div>
    <% } %>
  </form>

  <p>Don't have an account? <a href="/signup">Sign up</a></p>
</div>


<%- include("../../views/partials/user/footer") %>



<script>
  document.getElementById('resetPasswordForm').addEventListener('submit',async (e)=>{
    e.preventDefault();

    if(validateForm()){
      const password1=document.getElementById('newPass1').value;
      const password2=document.getElementById('newPass2').value;
      const response = await fetch('/reset-password',{
        method:"POST",
        headers:{
          'Content-Type':'application/json'
        },
        body:JSON.stringify({password1,password2})
      })

      const result=await response.json()

      if(response.ok){
        Swal.fire({
          title:"Done",
          text:"Password has been updated successfully",
          icon:"success",
          timer:1000,
          showConfirmButton:true
        }).then(()=>{
          window.location.href='/user-profile'
        })
      }else{
        Swal.fire("Failed",result.message,"error")
      }
    }
  })


    function validateForm() {
      let valid = true;
      const newPass1 = document.getElementById('newPass1');
      const newPass2 = document.getElementById('newPass2');
      const newPass1Error = document.getElementById('newPass1Error');
      const newPass2Error = document.getElementById('newPass2Error');


      newPass1Error.textContent = '';
      newPass2Error.textContent = '';


      if (!newPass1.value.trim()) {
          newPass1Error.textContent = 'Password cannot be empty.';
          valid = false;
      } else if (newPass1.value.length < 6) {
          newPass1Error.textContent = 'Password must be at least 6 characters long.';
          valid = false;
      }


      if (!newPass2.value.trim()) {
          newPass2Error.textContent = 'Please re-enter your password.';
          valid = false;
      } else if (newPass2.value !== newPass1.value) {
          newPass2Error.textContent = 'Passwords do not match.';
          valid = false;
      }
      return valid;
    }
</script>
